#!/bin/bash

set -e

export DOCKER_CLI_HINTS=false

LOG_LEVEL=${LOG_LEVEL:-extra}
EVIL_ANGEL_COOKIE_STR=${EVIL_ANGEL_COOKIE_STR:-cookie}
JULES_JORDAN_COOKIE_STR=${JULES_JORDAN_COOKIE_STR:-cookie}
MANUEL_FERRARA_COOKIE_STR=${MANUEL_FERRARA_COOKIE_STR:-cookie}
RICKYS_ROOM_COOKIE_STR=${RICKYS_ROOM_COOKIE_STR:-cookie}
SPIZOO_COOKIE_STR=${SPIZOO_COOKIE_STR:-cookie}
S3XUS_COOKIE_STR=${S3XUS_COOKIE_STR:-cookie}
ZTOD_COOKIE_STR=${ZTOD_COOKIE_STR:-cookie}

docker build --quiet -t xxx_download:0 .

docker run \
  -e RACK_ENV=test \
  -e LOG_LEVEL="$LOG_LEVEL" \
  -e EVIL_ANGEL_COOKIE_STR="$EVIL_ANGEL_COOKIE_STR" \
  -e JULES_JORDAN_COOKIE_STR="$JULES_JORDAN_COOKIE_STR" \
  -e MANUEL_FERRARA_COOKIE_STR="$MANUEL_FERRARA_COOKIE_STR" \
  -e RICKYS_ROOM_COOKIE_STR="$RICKYS_ROOM_COOKIE_STR" \
  -e S3XUS_COOKIE_STR="$S3XUS_COOKIE_STR" \
  -e SPIZOO_COOKIE_STR="$SPIZOO_COOKIE_STR" \
  -e ZTOD_COOKIE_STR="$ZTOD_COOKIE_STR" \
  -v "$(pwd)":/app \
  -it \
  xxx_download:0 \
  bundle exec rspec "$1"
